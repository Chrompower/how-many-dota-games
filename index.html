<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MMR Games Needed</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;max-width:520px;margin:40px auto;padding:0 16px;line-height:1.35}
    h1{font-size:20px;margin:0 0 16px}
    .row{margin:12px 0}
    label{display:block;font-size:14px;margin-bottom:6px}
    input{width:100%;padding:10px;font-size:16px}
    .out{margin-top:18px;padding:12px;border:1px solid #ccc}
    .big{font-size:22px;font-weight:700;margin-top:6px}
    .muted{color:#555;font-size:13px}
  </style>
</head>
<body>
  <h1>MMR Games Needed</h1>

  <div class="row">
    <label for="current">Your MMR</label>
    <input id="current" type="number" min="0" step="1" value="1000" />
  </div>

  <div class="row">
    <label for="target">Goal MMR</label>
    <input id="target" type="number" min="0" step="1" value="5000" />
  </div>

  <div class="row">
    <label for="winrate">Winrate (50–100)</label>
    <input id="winrate" type="number" min="50" max="100" step="0.1" value="55" />
    <div class="muted">Werte &lt; 50 werden auf 50 gesetzt, Werte &gt; 100 auf 100.</div>
  </div>

  <div class="out">
    <div class="muted">Games needed</div>
    <div class="big" id="games">—</div>
  </div>

  <script>
    (function(){
      const MMR_PER_GAME = 25;

      const currentEl = document.getElementById("current");
      const targetEl  = document.getElementById("target");
      const winEl     = document.getElementById("winrate");
      const gamesEl   = document.getElementById("games");

      function clamp(n, min, max){
        return Math.min(max, Math.max(min, n));
      }

      function ceilSafe(x){
        // gegen Floating-Point-Reste (z.B. 25.00000000002)
        return Math.ceil(x - 1e-12);
      }

      function toNumberOrNaN(v){
        // Number("") => 0 wäre schlecht; leer soll NaN sein
        const s = String(v ?? "").trim();
        if (s === "") return NaN;
        return Number(s);
      }

      function compute(){
        const current = toNumberOrNaN(currentEl.value);
        const target  = toNumberOrNaN(targetEl.value);
        let winPct    = toNumberOrNaN(winEl.value);

        // Wenn noch nicht alles sinnvoll befüllt ist:
        if (!Number.isFinite(current) || !Number.isFinite(target) || !Number.isFinite(winPct)){
          gamesEl.textContent = "—";
          return;
        }

        // Winrate clamp 50..100 (wie gewünscht)
        winPct = clamp(winPct, 50, 100);
        // Clamp auch im Input sichtbar machen
        if (Number(winEl.value) !== winPct) winEl.value = String(winPct);

        // Wenn current >= target => 0 Spiele
        if (current >= target){
          gamesEl.textContent = "0";
          return;
        }

        // Winrate == 50 => Unlimited
        // (Auch bei 50.0x die sehr nahe dran sind, behandeln wir es als 50)
        if (Math.abs(winPct - 50) < 1e-9){
          gamesEl.textContent = "Unlimited";
          return;
        }

        const delta = target - current;
        const p = winPct / 100;

        // Erwarteter MMR pro Spiel: 25*(2p - 1)
        const avg = MMR_PER_GAME * (2 * p - 1);

        // Sicherheit: falls avg <= 0, ebenfalls Unlimited
        if (avg <= 0){
          gamesEl.textContent = "Unlimited";
          return;
        }

        const rawGames = delta / avg;
        const needed = ceilSafe(rawGames);
        gamesEl.textContent = String(needed);
      }

      // Auto-update bei jeder Änderung (ohne Button)
      ["input", "change"].forEach(evt => {
        currentEl.addEventListener(evt, compute);
        targetEl.addEventListener(evt, compute);
        winEl.addEventListener(evt, compute);
      });

      // Initial berechnen
      compute();
    })();
  </script>
</body>
</html>
